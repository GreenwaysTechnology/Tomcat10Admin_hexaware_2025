Web server request processing:
......................................................

1.multi threaded model
2.single or limited threaded model


1.multi threaded model:

Each client request is handled by single thread

Request per thread model 
 for
	 1000 request = 1000 threads
	 N re = N threads

.single or limited threaded model
   single thread or fixed number of threads(10) can handle large concurrency -  non blocking / async
	
	1000 requests= 10 threads
****************
12/18/25
c/c++
 binary - .exe , dll
 unix - app

java :
 jar - java archive
 war  - web archive
 ear -enterprise archive - deprecated


server config - server.xml
app config - context.xml
wrapper config - web.xml

Listener:
  It is java program, it is started based on some events.
event could be
	before server start
	during server start
	after server ready

Starting a single tomcat server:
......................................................
  <Listener className="org.apache.catalina.startup.VersionLoggerListener" />
	It lists version informations about tomcat,jre

APR- Apache Portable Runtime:
......................................................
 APR- Apache Portable Runtime : It is a library that boots tomcat performance
       ,scalability,and native integration by providing advanced IO,os level functions
       and native process handling, often used in SSL for secure connections, enabling
       tomcat to act more like full fledged web server

server setup:

1. server info
2.apr initialization
3.connect initialization 
4.engine initialization
5.context initialization
6.deployment
7.ready to accept request

Admin Applications:
Tomcat Virtual Host Manager :
	To manage hosts like adding ,removing,edition host informations
Tomcat Web Application Manager
	To deploy,stop,undeploy and monitor web apps


How to deploy web apps?

spring boot application...
 -with embedded tomcat
 -with external tomcat
&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&

Lab 1:

Single server startup and configuration lookup

Lab 2:
	Single Server but two service configuration

server.xml
<?xml version="1.0" encoding="UTF-8"?>
<Server port="8005" shutdown="SHUTDOWN">
     <Listener className="org.apache.catalina.startup.VersionLoggerListener" />
     <Listener className="org.apache.catalina.core.AprLifecycleListener" />
     <Listener className="org.apache.catalina.core.JreMemoryLeakPreventionListener" />
     <Listener className="org.apache.catalina.mbeans.GlobalResourcesLifecycleListener" />
     <Listener className="org.apache.catalina.core.ThreadLocalLeakPreventionListener" />

     <GlobalNamingResources>
          <Resource name="UserDatabase" auth="Container"
               type="org.apache.catalina.UserDatabase"
               description="User database that can be updated and saved"
               factory="org.apache.catalina.users.MemoryUserDatabaseFactory"
               pathname="conf/tomcat-users.xml" />
     </GlobalNamingResources>

     <Service name="Catalina">
          <Connector port="8080" protocol="HTTP/1.1"
               connectionTimeout="20000"
               redirectPort="8443"
               maxParameterCount="1000"
          />
          <Engine name="Catalina" defaultHost="localhost">

               <Realm className="org.apache.catalina.realm.LockOutRealm">
                    <Realm className="org.apache.catalina.realm.UserDatabaseRealm"
                         resourceName="UserDatabase" />
               </Realm>

               <Host name="localhost" appBase="webapps"
                    unpackWARs="true" autoDeploy="true">
                    <Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs"
                         prefix="localhost_access_log" suffix=".txt"
                         pattern="%h %l %u %t &quot;%r&quot; %s %b" />

               </Host>
          </Engine>
     </Service>

     <Service name="NewCatalina">
          <Connector port="8081" protocol="HTTP/1.1"
               connectionTimeout="20000"
               redirectPort="8443"
               maxParameterCount="1000"
          />
          <Engine name="NewCatalina" defaultHost="localhost">

               <Realm className="org.apache.catalina.realm.LockOutRealm">
                    <Realm className="org.apache.catalina.realm.UserDatabaseRealm"
                         resourceName="UserDatabase" />
               </Realm>

               <Host name="localhost" appBase="webappsnew"
                    unpackWARs="true" autoDeploy="true">
                    <Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs"
                         prefix="localhost_access_log" suffix=".txt"
                         pattern="%h %l %u %t &quot;%r&quot; %s %b" />

               </Host>
          </Engine>
     </Service>
</Server>
&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
Memory Management:

A.java   ----compiler---A.class---->load class---->jvm starts creating object----create a meta object(Class Object)----->method,variable,constructors-----> actual instance is created.

class A {

}

new A()----->object creation------Eden

Garbage collection
&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&

Runtime parameter to jvm?

when run java applications, you need to start jvm first (it is process on which java apps are running including tomcat)

java       -cp MainApp

java --options -cp MainApp

Prefix           Category                                  stability
-  or --                  Standard Options                 Stable,document
-X                Non Standard options          Common, but not guranteed
-XX:+         Advanced/experimental  options    jvm Specific           
-XX:-     Advanced/experimental  options    jvm Specific           

-XX:+  = + Add a feature
-XX:-   =  - Remove a feature

eg:
java -verion
java -cp or java --class-path

-X -  means Extended 

eg:
 -Xms512m  - initali heap size
-Xmx4g - max heap size

java -Xms512m -Xmx4g -cp App 

   now the jvm starts with 512 mb initial heap size and it can grow up to 4g

what if these options keep on growing, or i need to set many more options

java -Xms512m -Xmx4g  -XnewOne -XnewOne -Xtwo -cp App 

how to reuse these options in future, so keeping this as part of java command not good idea, so you need to set this via environment variables

SET _JAVA_OPTIONS=-Xms512m -Xmx1024m  - windows
export _JAVA_OPTIONS="-Xms512m -Xmx1024m" - Linux

java -cp App
  now jvm automatically takes all parameters from that environment variable.


-XX:+ and -XX:-
+ means enable a feature
- means disable a feature.

-XX:+HeapDumponOutofMemoryError
     create heap dump information when outofmemory.
 Turn on heap dump on oom
   
-XX:-UseGCOverheadLimit
	Turn of GC overhead limit check.

eg:
java
  -XX:+UseG1GC
  -XX:+MaxGCPauseMillis=200
  -XX:++HeapDumponOutofMemoryError
  -XX: HeapDumppath=/opt/dumps
-jar app

Tomcat and jvm options configuration:
&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
In tomcat we have set two folders classification

≠ CATALINA_BASE
└── tomcat-base\           → CATALINA_BASE (runtime)
    ├── bin\
    │   └── setenv.bat
    ├── conf\
    ├── webapps\
    ├── logs\
    ├── temp\
    └── work\

setenv.bat
 This is the file where we define all java options  (-XX or -X)
 
startup ---->Catalina.bat---->$CATALINA_BASE/bin/setenv.bat

setenv.bat
@echo off

set  "JAVA_OPTS=-Xms128m -Xmx128m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=G:\hexaware\heapdump -XX:+ExitOnOutOfMemoryError"

GC Log configuration:

@echo off
set  "JAVA_OPTS=-Xms128m -Xmx128m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=G:\hexaware\labs\heapmemory -Xlog:gc*,gc+heap=info,gc+age=trace  -Xlog:gc*:file=G:\hexaware\labs\heapmemory\gclogs\gc.log:time,uptime,level,tags:filecount=5,filesize=10M -XX:+ExitOnOutOfMemoryError"


